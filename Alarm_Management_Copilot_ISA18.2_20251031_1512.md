
# Alarm Management Copilot (ISA-18.2-Based) â€” Design Documentation

## ğŸ§  Overview

This document describes how to build an **Alarm Management Copilot** trained on the **ISA-18.2 standard**, capable of analyzing alarm and event data, running calculations, visualizing metrics, and generating actionable recommendations.

---

## âš™ï¸ 1. Database Schema Design (Core Tables)

### **Table 1: `alarm_events`**
Stores every raw alarm occurrence (from your CSV).

| Column Name | Type | Description |
|--------------|------|-------------|
| `id` | INTEGER (PK) | Unique event ID |
| `event_time` | DATETIME | Timestamp of the alarm |
| `location_tag` | TEXT | Unit or subsystem (e.g. U100, U300) |
| `source` | TEXT | Source name (e.g. ALARMS_LTC) |
| `condition` | TEXT | Alarm condition (PVLOW, PVHI, OFFNRM, etc.) |
| `action` | TEXT | Whether it was acknowledged / returned to normal |
| `priority` | TEXT | Alarm priority (e.g., H, M, L) |
| `description` | TEXT | Alarm description text |
| `value` | FLOAT | Process variable value at time of alarm |
| `units` | TEXT | Engineering units |
| `sheet_name` | TEXT | Source file identifier |

---

### **Table 2: `alarm_summary_metrics`**
(Optional, for pre-aggregated statistics by day or shift)

| Column Name | Type | Description |
|--------------|------|-------------|
| `date` | DATE | Date of summary |
| `unit` | TEXT | Unit name (U100, etc.) |
| `total_alarms` | INTEGER | Total alarms |
| `avg_rate` | FLOAT | Alarms/hour |
| `chattering_alarms` | INTEGER | Alarms repeated within short interval |
| `floods_detected` | INTEGER | Number of flood periods |
| `standing_alarms` | INTEGER | Not cleared alarms older than threshold |
| `bad_actor_count` | INTEGER | Tags causing >20% of alarms |

---

### **Table 3: `rationalization_data`**
Used for recommendations or improvement suggestions.

| Column Name | Type | Description |
|--------------|------|-------------|
| `tag` | TEXT | Alarm tag |
| `cause` | TEXT | Known root cause |
| `recommendation` | TEXT | Engineering suggestion |
| `last_reviewed` | DATE | Review date |
| `is_rationalized` | BOOLEAN | If rationalization is done |

---

## ğŸ§  2. Query Mapping Logic

### **Basic Queries**

| User Query | SQL Query | Output |
|-------------|------------|--------|
| â€œHow many alarms in last 10 minutes?â€ | `SELECT COUNT(*) FROM alarm_events WHERE event_time >= NOW() - INTERVAL 10 MINUTE;` | Numeric count |
| â€œList all high priority alarms today.â€ | `SELECT * FROM alarm_events WHERE priority='H' AND DATE(event_time)=CURDATE();` | Table |
| â€œWhich tags had alarms?â€ | `SELECT DISTINCT location_tag FROM alarm_events;` | Text list |

---

### **Intermediate Queries**

| User Query | SQL Query | Output Type | Chart |
|-------------|------------|--------------|--------|
| â€œShow hourly alarm trend today.â€ | `SELECT HOUR(event_time) AS hour, COUNT(*) AS count FROM alarm_events WHERE DATE(event_time)=CURDATE() GROUP BY hour;` | DataFrame | Line chart |
| â€œCompare alarm counts by unit.â€ | `SELECT location_tag, COUNT(*) FROM alarm_events GROUP BY location_tag;` | Table | Bar chart |
| â€œTop 10 chattering alarms.â€ | Logic: difference between consecutive alarms <30 sec | Script + SQL | Bar chart |
| â€œAlarm distribution by priority.â€ | `SELECT priority, COUNT(*) FROM alarm_events GROUP BY priority;` | Table | Pie chart |

---

### **Advanced Queries**

| User Query | Processing Steps | Output Type |
|-------------|------------------|--------------|
| â€œIdentify bad actor alarms this month.â€ | Group by `location_tag`; sort by count; return top 10 | Table + Pareto chart |
| â€œFind flood periods.â€ | Sliding 10-minute window â†’ count alarms â‰¥10 | Timeline chart + flagged intervals |
| â€œShow standing alarms older than 24 hrs.â€ | Compare last OK vs ALARM states | Table |
| â€œAre we compliant with ISA-18.2?â€ | Compute alarms/operator/10 min < 1 | KPI summary + compliance % |
| â€œRecommend tuning based on data.â€ | Check repeating alarms â†’ link to `rationalization_data` â†’ generate suggestions | Text + table |
| â€œGenerate monthly performance report.â€ | Aggregate from `alarm_summary_metrics` | PDF/CSV report with charts |

---

## ğŸ“Š 3. Charts Generated by the Copilot

| Chart Type | Example Metric | Generated From |
|-------------|----------------|----------------|
| Line Chart | Hourly alarm trend | Alarms/hour |
| Bar Chart | Alarms by tag or unit | COUNT per group |
| Pareto Chart | Bad actor alarms | Cumulative contribution |
| Heatmap | Time vs. alarm count | 10-min buckets |
| Pie Chart | Priority distribution | % by priority |
| Timeline Chart | Flood visualization | Alarm spikes over time |
| Box Plot | Response times | Operator performance |

---

## ğŸ§® 4. ISA-18.2 Metrics Logic

| Metric | Formula | Threshold / Reference |
|---------|----------|-----------------------|
| Average Alarm Rate | (Total alarms Ã· time duration) | <1 alarm / 10 min / operator |
| Chattering Alarm % | (Chattering alarms Ã· total alarms) Ã— 100 | <5% recommended |
| Flood Frequency | # of 10-min periods with â‰¥10 alarms | Should be minimal |
| Standing Alarms | Alarms not cleared >24 hrs | <10% total |
| Bad Actor Contribution | % of alarms caused by top 10 tags | <80% total |
| Operator Load | Alarms per shift / operator | Within cognitive limits (~6/min peak) |

---

## ğŸ§© 5. Output Styles

| Output Type | Example |
|--------------|----------|
| Text summary | â€œAlarm rate exceeded limit during 14:00â€“14:10; 12 alarms detected.â€ |
| Table | Top 10 tags with counts and priorities |
| Chart | Hourly trend line with flood highlights |
| CSV Export | `alarm_summary_metrics.csv` |
| PDF Report | â€œMonthly ISA-18.2 Alarm Performance Summary.â€ |
| Recommendation | â€œTag U100_ALARMS_LTC should be rationalized due to frequent PVLOW triggers.â€ |

---

## âš™ï¸ 6. Backend Logic Summary

- Store alarms in **PostgreSQL or SQLite**  
- Use **FastAPI** endpoints (e.g. `/query`, `/chart`, `/report`)  
- Copilot interprets query â†’ generates SQL â†’ runs â†’ formats result  
- Use **Pandas + Matplotlib/Plotly** for analytics & visualization  
- Predefined templates for ISA-18.2 metrics & reports  

---

### âœ… Next Step

Create a **query mapping file** (e.g., JSON or Python dictionary) that links:  
- Natural-language query patterns â†’ SQL templates â†’ output types  

This allows the Copilot to handle natural queries automatically and produce accurate results, reports, or visualizations.
